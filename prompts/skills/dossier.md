# Skill: Досьє на користувача

## Тригери

Цей skill активується при запитах виду:
- "досьє на @username"
- "розкажи про користувача X"
- "хто такий X"
- "профіль X"
- "інформація про X"

## Інструкції

**ВАЖЛИВО: Відповідай УКРАЇНСЬКОЮ мовою.**

Створи детальне досьє на вказаного користувача на основі його активності в чаті.

### Общий подход к анализу

Прежде чем составлять досье:
1. Получи ВСЕ сообщения пользователя из базы данных
2. Внимательно прочитай содержание сообщений, чтобы извлечь:
   - Профессию/род деятельности (прямые упоминания работы, проектов, навыков)
   - Возраст или возрастную группу (если упоминается)
   - Хобби и увлечения (о чём пишет с энтузиазмом)
   - Семейное положение (упоминания семьи, детей, партнёра)
   - Место жительства или частые локации
   - Образование
   - Участие в активностях группы (встречи, мероприятия)
   - Роль в сообществе (новичок, эксперт, модератор, душа компании)
3. Выдели "истории" — запоминающиеся эпизоды с участием человека

---

## Формат вывода

**ВАЖНО**: Формат для Telegram и PDF должен быть ОДИНАКОВЫМ. Используй чистый markdown без ASCII-арта.

### Правила форматирования

1. **Заголовки**: Используй `##` для разделов, `###` для подразделов
2. **Данные**: Оформляй как таблицы или списки с двоеточием
3. **Списки**: Используй `•` для пунктов
4. **Ссылки**: Используй markdown формат `[текст](url)`
5. **Выделение**: **Жирный** для важного, _курсив_ для цитат
6. **НЕ ИСПОЛЬЗУЙ**: Символы ═══, ───, ▸, ║ и подобные

---

## Структура досье (4 раздела)

### РАЗДЕЛ 1: Карточка профиля

## ДОСЬЕ: [Display Name]
**@username**

### Идентификация

| Параметр | Значение |
|----------|----------|
| Username | @username |
| Имя | [display_name] |
| Сообщений | [N] |

### Личные данные

| Параметр | Значение |
|----------|----------|
| Возраст | [XX лет / ~30-35 / —] |
| Город | [город / —] |
| Профессия | [профессия] |
| Образование | [если известно] |

### Интересы и хобби

• [интерес 1]
• [интерес 2]
• [интерес 3]

### Семья

[женат/замужем, есть дети / не упоминается]

### Роль в сообществе

[эксперт по X / активный участник / новичок / ...]

### Связи в чате

Близкие контакты: @user1, @user2

---

### РАЗДЕЛ 2: Истории и эпизоды

**Пропустить раздел, если историй нет.**

## Истории и эпизоды

### [Название истории 1]

**Дата:** [дата]

[Краткое описание эпизода — что произошло, как отреагировало сообщество]

[Ссылка](permalink)

### Запоминающиеся высказывания

• _"[цитата]"_ — [контекст]
• _"[цитата]"_ — [контекст]

Истории могут включать:
- Споры и дискуссии, где человек активно участвовал
- Помощь другим участникам
- Смешные или абсурдные эпизоды
- Организация или участие в мероприятиях
- Конфликты (нейтрально)
- Личные истории, которыми делился

---

### РАЗДЕЛ 3: Подробный профиль

**Включать только те подразделы, по которым есть данные.**

## Подробный профиль

### Профессиональная деятельность

[Описание: чем занимается, какие проекты упоминал, какие навыки демонстрирует в обсуждениях, карьерный путь если известен]

### Хобби и увлечения

[Подробнее о каждом увлечении: как часто обсуждает, уровень экспертизы, связанные темы]

### Семья и личная жизнь

[Что известно о семье, детях, партнёре из публичных сообщений]

### Социальные связи в чате

**Близкие контакты:**
• @user1 — [характер связи: друзья, коллеги, часто спорят]
• @user2 — [характер связи]

**Взаимодействия:**
• Часто помогает: [кому и в чём]
• Обращается за помощью к: [кому]
• Частые собеседники: [список]

### Стиль общения

[Формальный/неформальный, использует ли мемы, характерные выражения, тон — дружелюбный, ироничный, экспертный и т.д.]

### Рекомендации и отзывы

**Рестораны/кафе:**
• [название] — _"[краткий отзыв]"_

**Сервисы/услуги:**
• [название] — _"[что говорил]"_

**Места/локации:**
• [название] — _"[впечатления]"_

---

### РАЗДЕЛ 4: Статистика

## Статистика активности

### Общая статистика

| Параметр | Значение |
|----------|----------|
| Всего сообщений | [N] |
| Первое сообщение | [дата] |
| Последнее сообщение | [дата] |
| Период активности | [X дней/месяцев/лет] |
| Сообщений в день | [среднее] |

### Паттерны активности

| Параметр | Значение |
|----------|----------|
| Активные дни | [Пн, Вт, Ср...] |
| Активные часы | [утро/день/вечер/ночь] |
| Пик активности | [когда максимум] |

### Реакции

| Параметр | Значение |
|----------|----------|
| Получено реакций | [N] |
| Чаще всего получает | [emoji1, emoji2] |

### Топ сообщений по реакциям

1. _"[начало сообщения...]"_ — **[N] реакций** [ссылка](permalink)
2. _"[начало сообщения...]"_ — **[N] реакций** [ссылка](permalink)
3. _"[начало сообщения...]"_ — **[N] реакций** [ссылка](permalink)

### Контент-анализ

| Параметр | Значение |
|----------|----------|
| Средняя длина сообщения | [N символов] |
| Часто использует слова | [слово1, слово2, ...] |
| Любимые темы | [тема1, тема2, ...] |

---

## SQL-запросы для сбора данных

```sql
-- Все сообщения пользователя (для анализа контента)
SELECT message, date_iso, permalink, reactions_count
FROM messages
WHERE sender_username = 'target_username'
   OR sender_display_name LIKE '%target_name%'
ORDER BY date_iso;

-- Основная статистика пользователя
SELECT
    sender_username,
    sender_display_name,
    sender_id,
    COUNT(*) as total_messages,
    MIN(date_iso) as first_message,
    MAX(date_iso) as last_message,
    AVG(LENGTH(message)) as avg_message_length
FROM messages
WHERE sender_username = 'target_username'
   OR sender_display_name LIKE '%target_name%';

-- Активность по дням недели
SELECT
    CASE strftime('%w', date_iso)
        WHEN '0' THEN 'Вс'
        WHEN '1' THEN 'Пн'
        WHEN '2' THEN 'Вт'
        WHEN '3' THEN 'Ср'
        WHEN '4' THEN 'Чт'
        WHEN '5' THEN 'Пт'
        WHEN '6' THEN 'Сб'
    END as day_name,
    COUNT(*) as messages
FROM messages
WHERE sender_username = 'target_username'
GROUP BY strftime('%w', date_iso)
ORDER BY messages DESC;

-- Активность по часам
SELECT
    strftime('%H', date_iso) as hour,
    COUNT(*) as messages
FROM messages
WHERE sender_username = 'target_username'
GROUP BY hour
ORDER BY messages DESC;

-- Топ сообщений по реакциям
SELECT message, reactions_count, permalink, date_iso
FROM messages
WHERE sender_username = 'target_username'
ORDER BY reactions_count DESC
LIMIT 10;

-- С кем взаимодействует (кому отвечает)
SELECT
    m2.sender_username as replies_to,
    m2.sender_display_name as name,
    COUNT(*) as count
FROM messages m1
JOIN messages m2 ON m1.reply_to_msg_id = m2.id
WHERE m1.sender_username = 'target_username'
GROUP BY m2.sender_id
ORDER BY count DESC
LIMIT 10;

-- Кто отвечает пользователю
SELECT
    m1.sender_username as replied_by,
    m1.sender_display_name as name,
    COUNT(*) as count
FROM messages m1
JOIN messages m2 ON m1.reply_to_msg_id = m2.id
WHERE m2.sender_username = 'target_username'
GROUP BY m1.sender_id
ORDER BY count DESC
LIMIT 10;
```

---

## Дополнительные указания

- **Приоритет контента над статистикой**: Внимательно читай сообщения, чтобы понять человека, а не просто считай цифры
- **Если данных мало** (< 20 сообщений): сократи досье до разделов 1 и 4, укажи что данных недостаточно для полного профиля
- **Пропускай пустые разделы**: Если нет историй — не включай раздел 2. Если неизвестна профессия — не пиши "—", просто пропусти строку
- **Нейтральность**: Описывай факты без оценочных суждений
- **Приватность**: Используй только информацию из публичных сообщений в чате
- **Связи**: Определяй друзей по частоте взаимодействий, тону общения, упоминаниям
- **Начинай сразу с досье**: НЕ пиши вступительный текст вроде "Тепер у мене достатньо інформації..." — сразу выдавай досье
