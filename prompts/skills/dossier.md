# Skill: Досье на пользователя

## Триггеры

Этот skill активируется при запросах вида:
- "досье на @username"
- "расскажи о пользователе X"
- "кто такой X"
- "профиль X"
- "информация о X"

## Инструкции

Создай подробное досье на указанного пользователя на основе его активности в чате. Досье должно быть структурировано для последующей генерации PDF-документа.

### Общий подход к анализу

Прежде чем составлять досье:
1. Получи ВСЕ сообщения пользователя из базы данных
2. Внимательно прочитай содержание сообщений, чтобы извлечь:
   - Профессию/род деятельности (прямые упоминания работы, проектов, навыков)
   - Возраст или возрастную группу (если упоминается)
   - Хобби и увлечения (о чём пишет с энтузиазмом)
   - Семейное положение (упоминания семьи, детей, партнёра)
   - Место жительства или частые локации
   - Образование
   - Участие в активностях группы (встречи, мероприятия)
   - Роль в сообществе (новичок, эксперт, модератор, душа компании)
3. Выдели "истории" — запоминающиеся эпизоды с участием человека

---

## Структура досье (4 раздела для PDF)

### РАЗДЕЛ 1: Карточка профиля (страница 1)

Краткая сводка ключевых фактов — только конкретика, без описаний.

```
═══════════════════════════════════════════════════
           ДОСЬЕ: [Display Name]
           @username
═══════════════════════════════════════════════════

▸ ИДЕНТИФИКАЦИЯ
  ID:               [sender_id]
  Username:         @[username]
  Имя:              [display_name]
  Сообщений:        [N] (выводы основаны на этом объёме)

▸ ЛИЧНЫЕ ДАННЫЕ (если удалось определить)
  Возраст:          [XX лет / ~30-35 / не определён]
  Текущий город:    [город / не определён]
  Жил в:            [город1, город2, ...]
  Профессия:        [профессия1, профессия2]
  Образование:      [если известно]

▸ ИНТЕРЕСЫ И ХОББИ
  • [интерес 1]
  • [интерес 2]
  • [интерес 3]
  • ...

▸ СЕМЬЯ (если упоминается)
  [женат/замужем, есть дети / не упоминается]

▸ РОЛЬ В СООБЩЕСТВЕ
  [эксперт по X / активный участник / новичок / ...]

▸ СВЯЗИ В ЧАТЕ
  Друзья/близкие контакты: @user1, @user2
```

---

### РАЗДЕЛ 2: Истории и эпизоды (страница 2)

Запоминающиеся моменты с участием пользователя. **Пропустить раздел, если историй нет.**

```
═══════════════════════════════════════════════════
              ИСТОРИИ И ЭПИЗОДЫ
═══════════════════════════════════════════════════

▸ ИСТОРИЯ 1: [Название/тема]
  Дата: [дата]
  Суть: [Краткое описание эпизода — что произошло,
        как отреагировало сообщество]
  Ссылка: [permalink]

▸ ИСТОРИЯ 2: [Название/тема]
  ...

▸ ЗАПОМИНАЮЩИЕСЯ ВЫСКАЗЫВАНИЯ
  • "[цитата]" — [контекст]
  • "[цитата]" — [контекст]
```

Истории могут включать:
- Споры и дискуссии, где человек активно участвовал
- Помощь другим участникам
- Смешные или абсурдные эпизоды
- Организация или участие в мероприятиях
- Конфликты (нейтрально)
- Личные истории, которыми делился

---

### РАЗДЕЛ 3: Подробный профиль (страница 3)

Развёрнутая информация о человеке. **Включать только те подразделы, по которым есть данные.**

```
═══════════════════════════════════════════════════
              ПОДРОБНЫЙ ПРОФИЛЬ
═══════════════════════════════════════════════════

▸ ПРОФЕССИОНАЛЬНАЯ ДЕЯТЕЛЬНОСТЬ
  [Описание: чем занимается, какие проекты упоминал,
   какие навыки демонстрирует в обсуждениях,
   карьерный путь если известен]

▸ ХОББИ И УВЛЕЧЕНИЯ
  [Подробнее о каждом увлечении:
   - Как часто обсуждает
   - Уровень экспертизы
   - Связанные темы]

▸ СЕМЬЯ И ЛИЧНАЯ ЖИЗНЬ
  [Что известно о семье, детях, партнёре
   из публичных сообщений]

▸ СОЦИАЛЬНЫЕ СВЯЗИ В ЧАТЕ
  Близкие контакты:
  • @user1 — [характер связи: друзья, коллеги, часто спорят]
  • @user2 — [характер связи]

  Взаимодействия:
  • Часто помогает: [кому и в чём]
  • Часто обращается за помощью к: [кому]
  • Частые собеседники: [список]

▸ СТИЛЬ ОБЩЕНИЯ
  [Формальный/неформальный, использует ли мемы,
   характерные выражения, тон — дружелюбный,
   ироничный, экспертный и т.д.]

▸ РЕКОМЕНДАЦИИ И ОТЗЫВЫ
  Рестораны/кафе:
  • [название] — "[краткий отзыв/контекст]"

  Сервисы/услуги:
  • [название] — "[что говорил]"

  Места/локации:
  • [название] — "[впечатления]"

  Продукты/товары:
  • [название] — "[мнение]"
```

---

### РАЗДЕЛ 4: Статистика (страница 4)

Сухие цифры и паттерны активности.

```
═══════════════════════════════════════════════════
              СТАТИСТИКА АКТИВНОСТИ
═══════════════════════════════════════════════════

▸ ОБЩАЯ СТАТИСТИКА
  Всего сообщений:        [N]
  Первое сообщение:       [дата]
  Последнее сообщение:    [дата]
  Период активности:      [X дней/месяцев/лет]
  Сообщений в день:       [среднее]

▸ ПАТТЕРНЫ АКТИВНОСТИ
  Активные дни:           [Пн, Вт, Ср...]
  Активные часы:          [утро/день/вечер/ночь, конкретные часы]
  Пик активности:         [когда максимум сообщений]

▸ РЕАКЦИИ
  Отправлено реакций:     [N]
  Получено реакций:       [N]
  Любимые реакции:        [emoji1, emoji2, emoji3]
  Чаще всего получает:    [какие реакции]

▸ ТОП СООБЩЕНИЙ ПО РЕАКЦИЯМ
  1. "[начало сообщения...]" — [N] реакций
     [permalink]
  2. ...
  3. ...

▸ КОНТЕНТ-АНАЛИЗ
  Средняя длина сообщения: [N символов]
  Часто использует слова:  [слово1, слово2, ...]
  Любимые темы:            [тема1, тема2, ...]
```

---

## SQL-запросы для сбора данных

```sql
-- Все сообщения пользователя (для анализа контента)
SELECT message, date_iso, permalink, reactions_count
FROM messages
WHERE sender_username = 'target_username'
   OR sender_display_name LIKE '%target_name%'
ORDER BY date_iso;

-- Основная статистика пользователя
SELECT
    sender_username,
    sender_display_name,
    sender_id,
    COUNT(*) as total_messages,
    MIN(date_iso) as first_message,
    MAX(date_iso) as last_message,
    AVG(LENGTH(message)) as avg_message_length
FROM messages
WHERE sender_username = 'target_username'
   OR sender_display_name LIKE '%target_name%';

-- Активность по дням недели
SELECT
    CASE strftime('%w', date_iso)
        WHEN '0' THEN 'Вс'
        WHEN '1' THEN 'Пн'
        WHEN '2' THEN 'Вт'
        WHEN '3' THEN 'Ср'
        WHEN '4' THEN 'Чт'
        WHEN '5' THEN 'Пт'
        WHEN '6' THEN 'Сб'
    END as day_name,
    COUNT(*) as messages
FROM messages
WHERE sender_username = 'target_username'
GROUP BY strftime('%w', date_iso)
ORDER BY messages DESC;

-- Активность по часам
SELECT
    strftime('%H', date_iso) as hour,
    COUNT(*) as messages
FROM messages
WHERE sender_username = 'target_username'
GROUP BY hour
ORDER BY messages DESC;

-- Топ сообщений по реакциям
SELECT message, reactions_count, permalink, date_iso
FROM messages
WHERE sender_username = 'target_username'
ORDER BY reactions_count DESC
LIMIT 10;

-- Реакции: какие отправляет (если есть таблица reactions)
SELECT reaction, COUNT(*) as count
FROM reactions
WHERE from_user = 'target_username'
GROUP BY reaction
ORDER BY count DESC
LIMIT 10;

-- Реакции: какие получает
SELECT reaction, COUNT(*) as count
FROM reactions r
JOIN messages m ON r.message_id = m.id
WHERE m.sender_username = 'target_username'
GROUP BY reaction
ORDER BY count DESC
LIMIT 10;

-- С кем взаимодействует (кому отвечает)
SELECT
    m2.sender_username as replies_to,
    m2.sender_display_name as name,
    COUNT(*) as count
FROM messages m1
JOIN messages m2 ON m1.reply_to_msg_id = m2.id
WHERE m1.sender_username = 'target_username'
GROUP BY m2.sender_id
ORDER BY count DESC
LIMIT 10;

-- Кто отвечает пользователю
SELECT
    m1.sender_username as replied_by,
    m1.sender_display_name as name,
    COUNT(*) as count
FROM messages m1
JOIN messages m2 ON m1.reply_to_msg_id = m2.id
WHERE m2.sender_username = 'target_username'
GROUP BY m1.sender_id
ORDER BY count DESC
LIMIT 10;
```

---

## Дополнительные указания

- **Приоритет контента над статистикой**: Внимательно читай сообщения, чтобы понять человека, а не просто считай цифры
- **Если данных мало** (< 20 сообщений): сократи досье до разделов 1 и 4, укажи что данных недостаточно для полного профиля
- **Пропускай пустые разделы**: Если нет историй — не включай раздел 2. Если неизвестна профессия — не пиши "не определена", просто пропусти строку
- **Нейтральность**: Описывай факты без оценочных суждений
- **Приватность**: Используй только информацию из публичных сообщений в чате
- **Связи**: Определяй друзей по частоте взаимодействий, тону общения, упоминаниям
- **Формат для PDF**: Используй фиксированную ширину блоков, избегай слишком длинных строк
