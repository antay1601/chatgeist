# Расчёт стоимости запросов ChatGeist Bot

## Конфигурация

- **Модель:** Claude Sonnet 4 (claude-sonnet-4-20250514)
- **API:** Anthropic API (прямой доступ через API ключ)
- **Pricing:** $3/1M input tokens, $15/1M output tokens

## Структура запроса

| Компонент | Описание | Токены |
|-----------|----------|--------|
| Base промпт | `prompts/base.md` — схема БД, инструкции | ~600 |
| Skill промпт | `prompts/skills/*.md` — досье, поиск, топы | ~300 |
| Запрос пользователя | Текст вопроса | ~50-200 |
| История диалога | При reply на сообщение бота | ~0-2000 |
| SQL результаты | Данные из БД (1-3 запроса) | ~500-5000 |
| **Input итого** | | **~1500-8000** |
| **Output (ответ)** | Ответ Claude | **~500-2000** |

## Стоимость по сценариям

| Сценарий | Пример | Input | Output | Цена |
|----------|--------|-------|--------|------|
| Простой | "Скільки повідомлень?" | 2000 | 500 | **$0.014** (1.4¢) |
| Средний | "Топ-10 активних учасників" | 3500 | 1000 | **$0.026** (2.6¢) |
| Сложный | "Досьє на @user з аналізом" | 5000 | 1500 | **$0.038** (3.8¢) |
| Очень сложный | Длинная история + много данных | 8000 | 2000 | **$0.054** (5.4¢) |

## Бюджетирование

| Бюджет | Простых | Средних | Сложных |
|--------|---------|---------|---------|
| $1 | ~70 | ~40 | ~25 |
| $5 | ~350 | ~190 | ~130 |
| $10 | ~700 | ~380 | ~260 |
| $20 | ~1400 | ~770 | ~520 |

## Рекомендации по лимитам

### Вариант 1: Лимит по запросам
- **10 запросов/час** на пользователя — защита от злоупотреблений
- **50 запросов/день** на пользователя — разумный дневной лимит

### Вариант 2: Whitelist + лимиты
- Whitelist пользователей — без лимитов
- Остальные — 5 запросов/день (ознакомительный режим)

### Вариант 3: Бюджетный лимит
- Отслеживать примерную стоимость запросов
- Останавливать при достижении дневного бюджета ($1-5/день)

## Мониторинг

Проверить использование API:
```bash
# На console.anthropic.com/settings/billing
# Или через API:
curl https://api.anthropic.com/v1/usage \
  -H "x-api-key: $ANTHROPIC_API_KEY"
```

---

*Актуально на январь 2026. Цены могут измениться.*
