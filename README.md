# ChatGeist: AI-Powered Chat Analyzer

ChatGeist — это набор инструментов для анализа архивов чатов с помощью искусственного интеллекта. Он предоставляет два интерфейса — **CLI (интерфейс командной строки)** и **Telegram-бот** — для выполнения запросов к вашей базе данных сообщений через Claude AI.

В основе системы лежит скрипт, который формирует подробные запросы к **Claude CLI**, заставляя его анализировать локальную базу данных SQLite, созданную из вашего экспорта чатов Telegram.

## Как это работает

Весь процесс можно разбить на три этапа:

1.  **Конвертация данных**: Вы экспортируете историю чата из Telegram в формате `JSONL` и с помощью скрипта `convert_jsonl_to_sqlite.py` преобразуете её в базу данных `telegram_messages.db`.
2.  **Формирование запроса**: Когда вы задаете вопрос через CLI или бота, скрипт `ask_claude_cli.py` формирует специальный промпт. Этот промпт содержит ваш вопрос и инструкцию для Claude AI использовать базу данных `telegram_messages.db` для поиска ответа.
3.  **Анализ и ответ**: Скрипт вызывает установленный в вашей системе **Claude CLI**, передавая ему сгенерированный промпт. Claude AI анализирует данные и возвращает развернутый ответ, который затем отображается в консоли или отправляется в Telegram.

## Ключевые компоненты

-   `export_dir/convert_jsonl_to_sqlite.py`: Скрипт для преобразования `messages.jsonl` в `telegram_messages.db`.
-   `ask_claude_cli.py`: Основной скрипт, который содержит логику для вызова Claude CLI. Может использоваться как самостоятельный инструмент.
-   `bot_with_claude_cli.py`: Telegram-бот, который импортирует и использует `ask_claude_cli.py` для ответа на запросы пользователей.

## Требования

-   Python 3.12+
-   `uv` (менеджер пакетов Python)
-   **Claude CLI**: Установленный и доступный в системном `PATH`. Инструкции по установке можно найти в [официальном репозитории](https://github.com/anthropics/claude-cli).
-   Файл экспорта сообщений `messages.jsonl` из Telegram.

## Установка и настройка

### Шаг 1: Установка Claude CLI

Прежде всего, установите Claude CLI, следуя [официальной инструкции](https://github.com/anthropics/claude-cli). Убедитесь, что команда `claude` доступна из вашей консоли.

### Шаг 2: Установка зависимостей проекта

1.  Клонируйте репозиторий:
    ```bash
    git clone https://github.com/ваш-логин/chatgeist.git
    cd chatgeist
    ```

2.  Создайте виртуальное окружение и установите зависимости Python:
    ```bash
    uv sync
    ```

3.  Создайте файл `.env` из примера. Он нужен для токена Telegram-бота.
    ```bash
    cp .env.example .env
    ```

4.  (Опционально) Если вы планируете использовать Telegram-бота, получите токен у [@BotFather](https://t.me/botfather) и добавьте его в `.env`:
    ```
    TELEGRAM_BOT_TOKEN=ваш_токен_здесь
    ```

## Порядок работы

### Шаг 1: Подготовка базы данных

1.  Экспортируйте историю вашего чата из Telegram Desktop в формате "JSON lines".
2.  Поместите полученный файл `messages.jsonl` в папку `export_dir`.
3.  Запустите скрипт конвертации:
    ```bash
    uv run python export_dir/convert_jsonl_to_sqlite.py
    ```
    После выполнения в корневой папке проекта появится файл `telegram_messages.db`.

### Шаг 2: Анализ данных

Теперь вы можете задавать вопросы к вашей базе данных одним из двух способов:

#### Вариант А: Через CLI

Запустите `ask_claude_cli.py`, передав ваш вопрос в кавычках в качестве аргумента:
```bash
uv run python ask_claude_cli.py "Кто самый активный участник чата за последний месяц?"
```
Ответ будет выведен в консоль и сохранен в файл `claude_response.md`.

#### Вариант Б: Через Telegram-бота

1.  Запустите бота:
    ```bash
    uv run python bot_with_claude_cli.py
    ```
2.  Найдите вашего бота в Telegram и отправьте ему любой вопрос для анализа. Бот перенаправит его в Claude CLI и вернет вам готовый отчет.

## Структура проекта

```
chatgeist/
├── ask_claude_cli.py        # CLI для анализа через Claude CLI
├── bot_with_claude_cli.py   # Telegram-бот (использует ask_claude_cli.py)
├── export_dir/
│   ├── convert_jsonl_to_sqlite.py # Скрипт конвертации JSONL в SQLite
│   └── messages.jsonl       # Исходные данные (не в git)
├── telegram_messages.db     # База данных SQLite (не в git)
├── .env                     # Переменные окружения (не в git)
├── .env.example             # Пример конфигурации
├── pyproject.toml           # Конфигурация проекта и зависимости
└── README.md                # Этот файл
```

## Лицензия

MIT